<?php
//include_once 'kanboard_tarefa_unitaria.php';

class kanboard_coluna_tarefas{
    private $_tarefas_internas = array();
    private $_id_coluna;
    private $_coluna_Ordenavel;
    private $_id_projeto;
    
    public function __construct($param_bruto, $id_coluna, $id_projeto){
        $this->_id_coluna = $id_coluna;
        $this->_id_projeto = $id_projeto;
        $this->_coluna_Ordenavel = true;
        $tarefas = $param_bruto['tarefas'];
        foreach ($tarefas as $t){
            $tarefa_interna = new kanboard_tarefa_unitaria($t);
            $this->_tarefas_internas[$tarefa_interna->getPosicao()] = $tarefa_interna;
        }
        ksort($this->_tarefas_internas);
    }
    
    public function __toString(){
        $ret = '<td class="board-column-' . $this->_id_coluna . '"' . $this->gerarStyleTd() . '>';
        $ret .= $this->geraHtmlExpandido();
        $ret .= $this->gerarHtmlColapsado();
        $ret .= '</td>';
        return $ret;
    }
    
    private function gerarStyleTd(){
        return '    style="--color-primary: #333;
    --color-light: #999;
    --color-lighter: #dedede;
    --color-dark: #000;
    --color-medium: #555;
    --color-error: #b94a48;
    --link-color-primary: #36C;
    --link-color-focus: #DF5353;
    --link-color-hover: #333;
    --alert-color-default: #c09853;
    --alert-color-success: #468847;
    --alert-color-error: #b94a48;
    --alert-color-info: #3a87ad;
    --alert-color-normal: #333;
    --alert-background-color-default: #fcf8e3;
    --alert-background-color-success: #dff0d8;
    --alert-background-color-error: #f2dede;
    --alert-background-color-info: #d9edf7;
    --alert-background-color-normal: #f0f0f0;
    --alert-border-color-default: #fbeed5;
    --alert-border-color-success: #d6e9c6;
    --alert-border-color-error: #eed3d7;
    --alert-border-color-info: #bce8f1;
    --alert-border-color-normal: #ddd;
    --button-default-color: #333;
    --button-default-background-color: #f5f5f5;
    --button-default-border-color: #ddd;
    --button-default-color-focus: #000;
    --button-default-background-color-focus: #fafafa;
    --button-default-border-color-focus: #bbb;
    --button-primary-color: #fff;
    --button-primary-background-color: #4d90fe;
    --button-primary-border-color: #3079ed;
    --button-primary-color-focus: #fff;
    --button-primary-background-color-focus: #357ae8;
    --button-primary-border-color-focus: #3079ed;
    --button-danger-color: #fff;
    --button-danger-background-color: #d14836;
    --button-danger-border-color: #b0281a;
    --button-danger-color-focus: #fff;
    --button-danger-background-color-focus: #c53727;
    --button-danger-border-color-focus: #b0281a;
    --button-disabled-color: #ccc;
    --button-disabled-background-color: #f7f7f7;
    --button-disabled-border-color: #ccc;
    --avatar-color-letter: #fff;
    --activity-title-color: #000;
    --activity-title-border-color: #efefef;
    --activity-event-background-color: #fafafa;
    --activity-event-hover-color: #fff8dc;
    --user-mention-color: #000;
    --board-task-limit-color: #DF5353;
    font-family: Helvetica,Arial,sans-serif;
    text-rendering: optimizeLegibility;
    border-collapse: collapse;
    border-spacing: 0;
    margin: 0;
    border: 1px solid #eee;
    padding: .5em 3px;
    vertical-align: top;
    box-sizing: initial;"';
    }
    
    private function geraHtmlExpandido(){
        $ret = '<div class="board-task-list board-column-expanded ' . ($this->_coluna_Ordenavel ? 'sortable-column ' : '') . 'ui-sortable"
                data-column-id="' . $this->_id_coluna . '"
                data-swimlane-id="' . $this->_id_projeto . '"
                data-task-limit="0"
                ' . $this->gerarStyleDivHtmlExpandido() . '
                >';
        foreach ($this->_tarefas_internas as $t){
            $ret .= $t;
        }
        $ret .= '</div>';
        return $ret;
    }
    
    private function gerarStyleDivHtmlExpandido(){
        return ' style="    --color-primary: #333;
    --color-light: #999;
    --color-lighter: #dedede;
    --color-dark: #000;
    --color-medium: #555;
    --color-error: #b94a48;
    --link-color-primary: #36C;
    --link-color-focus: #DF5353;
    --link-color-hover: #333;
    --alert-color-default: #c09853;
    --alert-color-success: #468847;
    --alert-color-error: #b94a48;
    --alert-color-info: #3a87ad;
    --alert-color-normal: #333;
    --alert-background-color-default: #fcf8e3;
    --alert-background-color-success: #dff0d8;
    --alert-background-color-error: #f2dede;
    --alert-background-color-info: #d9edf7;
    --alert-background-color-normal: #f0f0f0;
    --alert-border-color-default: #fbeed5;
    --alert-border-color-success: #d6e9c6;
    --alert-border-color-error: #eed3d7;
    --alert-border-color-info: #bce8f1;
    --alert-border-color-normal: #ddd;
    --button-default-color: #333;
    --button-default-background-color: #f5f5f5;
    --button-default-border-color: #ddd;
    --button-default-color-focus: #000;
    --button-default-background-color-focus: #fafafa;
    --button-default-border-color-focus: #bbb;
    --button-primary-color: #fff;
    --button-primary-background-color: #4d90fe;
    --button-primary-border-color: #3079ed;
    --button-primary-color-focus: #fff;
    --button-primary-background-color-focus: #357ae8;
    --button-primary-border-color-focus: #3079ed;
    --button-danger-color: #fff;
    --button-danger-background-color: #d14836;
    --button-danger-border-color: #b0281a;
    --button-danger-color-focus: #fff;
    --button-danger-background-color-focus: #c53727;
    --button-danger-border-color-focus: #b0281a;
    --button-disabled-color: #ccc;
    --button-disabled-background-color: #f7f7f7;
    --button-disabled-border-color: #ccc;
    --avatar-color-letter: #fff;
    --activity-title-color: #000;
    --activity-title-border-color: #efefef;
    --activity-event-background-color: #fafafa;
    --activity-event-hover-color: #fff8dc;
    --user-mention-color: #000;
    --board-task-limit-color: #DF5353;
    font-family: Helvetica,Arial,sans-serif;
    text-rendering: optimizeLegibility;
    border-collapse: collapse;
    border-spacing: 0;
    min-height: 0!important;
    min-width: 100px;
    box-sizing: initial;
    min-height: 100px;"';
    }
    
    private function gerarHtmlColapsado(){
        $ret = '';
        return $ret;
    }
}